CVE-2023-32243
- Plugin : Essential Addons for Elementor
- Phiên bản lỗi:5.7.1
- Lỗi: Broken Authentication and Session Management
  
a) Mô tả
- Essential Addons for Elementor là bộ addons cung cấp thêm các widget và thư viện mẫu giúp quá trình chỉnh sửa được dễ dàng hơn, plugin hoạt động tốt ngay cả trên phiên bản Elementor miễn phí
- Plugin không xác thực khóa đặt lại mật khẩu, điều này có thể cho phép kẻ tấn công không được xác thực đặt lại mật khẩu của tài khoản tùy ý thành bất kỳ thứ gì chúng muốn, bằng cách biết email hoặc tên người dùng liên quan, giành quyền truy cập vào chúng
 
b)hàm xử lý bị lỗi
- Nhìn vào tệp Bootstrap.php nằm trong Bao gồm\Lớp, chúng ta có thể thấy hành động init . Hành động này kích hoạt một chức năng gọi là login_or_register_user .
![image](https://github.com/Manh130902/wordpress/assets/93723285/9b3e30f7-6f48-4667-a4b5-be402454e4b7) Khởi tạo hành động — Đăng nhập hoặc đăng ký Chức năng người dùng
 

- Hàm này nằm trong tệp PHP Đăng nhập_Registration, được nhập trước đó trong tệp Bootstrap trên dòng 15.

![image](https://github.com/Manh130902/wordpress/assets/93723285/629d6519-ad2b-4fa1-ab15-ae467bda98f8)  Đặc điểm Đăng ký Đăng nhập
 
- Theo dõi hàm trong tệp Đăng nhập_Đăng ký, chúng ta có thể thấy nó nằm ở dòng 42. Hàm này chỉ cần kiểm tra hàm nào sẽ kích hoạt dựa trên giá trị tham số yêu cầu mà nó nhận được.
- Hàm chúng ta quan tâm là hàm reset_password . Chúng ta có thể thấy nó được gọi thông qua $this, trong trường hợp này nó được tìm thấy trong cùng một tệp.
![image](https://github.com/Manh130902/wordpress/assets/93723285/fff41db4-c4e8-4ff8-bdcd-fa9bdb645747) Đăng nhập hoặc Đăng ký chức năng người dùng
 
- Hàm reset_password có thể được tìm thấy ở dòng 784. Đoạn đầu tiên của hàm này khá đơn giản. Chúng tôi đang kiểm tra xem thông số page_id và widget_id có trống hay không. Không có giá trị cụ thể nào đang được kiểm tra chéo.
![image](https://github.com/Manh130902/wordpress/assets/93723285/058eba3b-0975-4240-9566-7f35d9d4f406) Kiểm tra các thông số cần thiết

- Tiếp theo, mã sẽ kiểm tra xem có giá trị nonce nào được chuyển trong yêu cầu thông qua tham số eael_resetpassword_nonce hay không . Nếu giá trị không trống, nó sẽ được xác minh thông qua hàm wp_verify_nonce trên dòng 833.
![image](https://github.com/Manh130902/wordpress/assets/93723285/9f732a84-74e4-47e7-a0b1-4cbd5179b7cd) Kiểm tra nonce hợp lệ
 
- Sau đó, các tham số eael-pass-1 và eael-pass-2 được chạy theo một số kiểm tra tiêu chuẩn. Về cơ bản, 2 trường đó là “mật khẩu” và “xác nhận mật khẩu”. Việc kiểm tra bao gồm so sánh chuỗi để kiểm tra xem mật khẩu có trống không và chúng có khớp không.
 ![image](https://github.com/Manh130902/wordpress/assets/93723285/b6fca07e-27c8-4125-8555-3153f2ce03a4) Kiểm tra mật khẩu


- Nếu tất cả các bước kiểm tra đều đạt, ở dòng 888 và 889, biến rp_login đã được thiết lập. Biến rp_login chỉ đơn giản là tên người dùng của nạn nhân. Sau khi biến được thiết lập, biến đó sẽ được chuyển đến hàm 'getter' get_user_by . Phản hồi sau đó được lưu trữ trong biến người dùng .
![image](https://github.com/Manh130902/wordpress/assets/93723285/1546fe76-6aed-40af-856b-376abd128af2)

- Nếu người dùng hợp lệ và không có lỗi nào được kích hoạt, hàm reset_password được gọi với các biến người dùng và eael-pass-1 (mật khẩu) làm tham số trên dòng 892.
![image](https://github.com/Manh130902/wordpress/assets/93723285/a1a395c3-d4ef-403c-9281-f92a8619f516) Thiết lập đặt lại mật khẩu rp_login

c) Khai thác 
- Trước tiên, bạn nhập một vài thư viện để gửi yêu cầu HTTP và phân tích dữ liệu phản hồi HTML cũng như các giá trị đối số do người dùng cung cấp.
- Tiếp theo, hàm check_version được định nghĩa để kiểm tra phiên bản plugin dễ bị tấn công “ essential addons for elementor lite ” bằng cách nhấn vào tệp readme.txt và kiểm tra xem phiên bản hiện tại có phải là phiên bản đã vá hay không.
 ![image](https://github.com/Manh130902/wordpress/assets/93723285/724b4bb1-8925-42c7-b64b-ed9dd5304523) Kiểm tra phiên bản

- Sau đó, hàm extract_usernames chạy thêm 2 hàm khác. Cái đầu tiên sử dụng nguồn cấp dữ liệu RSS của WordPress để trích xuất tên người dùng từ phản hồi XML. Cách thứ hai là nhấn vào điểm cuối API REST để truy vấn người dùng.
- Hàm select_username được xác định sau đó, cho phép người dùng chọn tên người dùng từ danh sách tên người dùng được trả về (đó là một cụm từ 'tên người dùng' và 'tên người dùng' trong câu…).
- Điều đáng chú ý là api_url trong hàm get_usernames_rest_api đã bị thay đổi. Tôi đã phải thêm “index.php” khi tôi đang thử nghiệm trên phòng thí nghiệm WordPress của mình.
 ![image](https://github.com/Manh130902/wordpress/assets/93723285/d16241df-b0b5-4eab-9b2a-a7c7ebe2f643) Trích xuất tên người dùng, Lấy tên người dùng, Chọn tên người dùng

- Sau đó, hàm extract_nonce được xác định. Thật đơn giản, lấy wordpress_url sau đó sử dụng BeautifulSoup4 để phân tích phản hồi. Nó cố gắng tìm chuỗi “var localize” bên trong thẻ script.
- Từ đó, nó kiểm tra giá trị chuỗi “nonce” bằng cách tìm kiếm “nonce” và sau đó di chuyển bộ chọn 9 ký tự về phía trước.
 ![image](https://github.com/Manh130902/wordpress/assets/93723285/468c891d-ba3f-4d22-85f4-ca81d031b548) Trích xuất nonce

- Cuối cùng, hàm send_request được xác định để gửi yêu cầu tới admin-ajax.php — phần tải trọng là phần nội dung của yêu cầu POST. Nó bao gồm số nonce được trích xuất, mật khẩu sẽ được đặt và tên người dùng của mục tiêu.
 ![image](https://github.com/Manh130902/wordpress/assets/93723285/4e7e6bbb-e6d7-4e5c-b0be-6ad357e33902) Chức năng gửi yêu cầu


- Và cuối cùng, kịch bản đã được sử dụng. Tôi đã lưu trữ một phiên bản WordPress có cài đặt Elementor. Tôi đảm bảo cũng cài đặt phiên bản Essential Addons cho Elementor đã lỗi thời .
 ![image](https://github.com/Manh130902/wordpress/assets/93723285/9d942805-a7ec-4ca9-828c-af375ef6ab13) Tập lệnh đang hoạt động


- Như bạn có thể thấy, mật khẩu đã được cập nhật. Bây giờ tôi có thể đăng nhập vào người dùng 'retkoussa' bằng mật khẩu 'password123'.
 ![image](https://github.com/Manh130902/wordpress/assets/93723285/bf272c4d-ce50-4acf-8ab3-05ef5b457130)

Đăng nhập WordPress thành công

