CVE-2023-2546
- Plugin : WP User Switch
- Phiên bản lỗi : 1.0.2
- Lỗi : Subscriber + Authentication Bypass
- CVSS Score: 8.8 (HIGH)

a) Mô tả
- WP User Switch là một plugin rất đơn giản. Nó sẽ giúp bạn chuyển đổi giữa các tài khoản của người dùng trong trang web WordPress. Chỉ bằng một cú nhấp chuột đơn giản, bạn sẽ ngay lập tức bị đăng xuất khỏi tài khoản hiện tại và đăng nhập vào tài khoản mong muốn mà không cần nhập bất kỳ tên người dùng và mật khẩu nào. Điều này rất hữu ích cho môi trường thử nghiệm nơi quản trị viên trang web thường xuyên chuyển đổi giữa các tài khoản khác nhau cho nhiều mục đích.

b) Hàm xử lý bị lỗi
- Plugin liệt kê các liên kết cần thiết để chuyển đổi người dùng bằng nonce trong thanh quản trị.
- Hàm kiểm tra quyền hiển thị trình chuyển đổi trong thanh quản trị, xem người dùng có phải là quản trị viên hay không, bằng hàm wpus_allow_user_to_admin_bar_menu():
![image](https://github.com/Manh130902/wordpress/assets/93723285/42eb0eb3-5f49-4c6e-a7f4-79ef1ca04fbb)
 
- Hàm kiểm tra quyền liệt kê người dùng, xem người dùng có phải là quản trị viên hay không, bằng hàm wpus_is_switcher_admin()
![image](https://github.com/Manh130902/wordpress/assets/93723285/3f643254-cd3a-42f2-8356-a336ed7b24d8)
  
- Như bạn có thể thấy plugin không sử dụng bất kỳ mã hóa nào cho giá trị cookie. Vì vậy, nó là một giá trị mà người dùng có thể dễ dàng thay đổi.
c) Khai thác
- Đầu tiên hãy xem trang quản trị của admin khi sử dụng plugin WP User Switch
![image](https://github.com/Manh130902/wordpress/assets/93723285/cd1e27cb-7f16-4f8f-bf50-f9113f877acb)
 
- Ta có thể thấy chỉ có admin có trang quản trị của plugin và sẽ có thanh chuyển đổi User Switch
- Tiếp theo ta sẽ xem cookie của admin nhé
![image](https://github.com/Manh130902/wordpress/assets/93723285/70da2a91-5723-4232-93b6-3baaaac41535)
 
- Ta thấy :
   + Tên cookie: wpus_who_switch
   + Giá trị cookie: test
- Cookie hoàn toàn ở bản rõ và dễ dàng có thể bị thay thế
- Bây giờ ta sẽ đăng nhập vào tài khoản của Subscriber 
![image](https://github.com/Manh130902/wordpress/assets/93723285/76938dfb-eed5-47da-8f9d-0d729e7bcd3b)
 
- Ta thấy tài khoản của Subscriber không có thanh chuyển đổi User Switch. Ta xem cookie của tài khoản
![image](https://github.com/Manh130902/wordpress/assets/93723285/16008b03-ae8d-4b26-a4da-895b841191d6)
 
- Ta thấy :
   + Tên cookie: wpus_who_switch
   + Giá trị cookie: minkay
- Giả sử là attacker biết được cookie “wpus_who_switch” của admin thì khi chỉnh sửa cookie và reload lại trang 
![image](https://github.com/Manh130902/wordpress/assets/93723285/6cdb324e-fc64-4027-a2e4-8300ab50d20d)
 
- Lúc này plugin đã check và thấy cookie của attacker là của admin và xuất hiện thanh chuyển đổi User Switch. Lúc này ta có thể chuyển đổi sang tài khoản admin 1 cách tự do.
![image](https://github.com/Manh130902/wordpress/assets/93723285/e07c530e-4880-4d8b-b134-cbb7121843f9)
 

d) Sửa Lỗi
- Phiên bản vá lỗi : 1.0.3
![image](https://github.com/Manh130902/wordpress/assets/93723285/d4a9a56b-aa6e-4edb-ba19-1cf61d002c1e)
 


