# CVE-2023-2706

- Plugin : OTP Login Woocommerce & Gravity Forms
- Phiên bản lỗi : 2.2
- Lỗi : Unauthenticated Privilege Escalation
- CVSS Score: 8.1 (HIGH)

# Mô tả

- Plugin cho phép OTP Login Woocommerce & Gravity Forms người dùng đăng nhập/đăng ký bằng mật khẩu một lần (OTP) được gửi trên thiết bị di động của bạn.
- Plugin trả về mã OTP đã tạo để người dùng sử dụng khi sử dụng tính năng đăng nhập qua số điện thoại, cho phép người dùng chưa được xác thực truy xuất chúng cho các tài khoản tùy ý và có thể đăng nhập với tư cách bất kỳ người dùng nào, kể cả quản trị viên nếu họ biết số điện thoại .

# Hàm xử lý bị lỗi

- Phương thứ request_otp() nằm trong tệp Xoo_Ml_Phone_Verification.php tạo và gửi một mã otp bằng đoạn mã sau
  ![image](https://github.com/Manh130902/wordpress/assets/93723285/51cd6163-b81a-4694-ae0c-6a797d4ac482)

- Nhưng otp cũng được trả về trong phản hồi ajax
  ![image](https://github.com/Manh130902/wordpress/assets/93723285/d5b9c921-c345-4ccd-9f22-4cc2368bab20)

- Như vậy mã otp đúng ra chỉ gửi về tin nhắn sẽ trở nên công khai và kẻ tấn công có thể lợi dụng điều đó để đăng nhập vào tài khoản khác một cách bất hợp pháp.

# Khai thác

- B1: Vào giao diện đăng nhập bằng OTP
  ![image](https://github.com/Manh130902/wordpress/assets/93723285/7faf6def-7a56-4f14-b933-c4c6603c7350)

- B2: Nhập số điện thoại vào và nhấn nhận mã otp
  ![image](https://github.com/Manh130902/wordpress/assets/93723285/bce7f80c-bbb8-4df6-abc4-103d57422ff5)

- B3: Kiểm tra respone ajax trả về
  ![image](https://github.com/Manh130902/wordpress/assets/93723285/39bdfbbb-42ce-4ad6-b491-3de7db076b02)

- Kết quả trả về là một JSON như sau:
  ![image](https://github.com/Manh130902/wordpress/assets/93723285/4423de47-79ab-4a8a-9dbe-e66760bf0e02)

- Từ mã JSON ta có thể thấy có mã OTP và ta lấy mã để xác thực đăng nhập thôi!!!

# Sửa lỗi

- Phiên bản vá lỗi: 2.3
  ![image](https://github.com/Manh130902/wordpress/assets/93723285/a9e8f20a-7150-4003-8bfd-f4ad1ce38d75)

- Như vậy giờ đây giá respone ajax trả về sẽ không có giá trị OTP nữa.
