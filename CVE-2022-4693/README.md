# CVE-2022-4693

- Plugin : User Verification
- Phiên bản lỗi : 1.0.93
- Lỗi : Authentication Bypass
- CVSS Score: 9.8 (CRITICAL)

# Mô tả

- Bảo vệ trang web của bạn khỏi người dùng spam và ngừng truy cập tức thì bằng cách sử dụng địa chỉ email spam, bởi người dùng plugin này sẽ cần xác minh email của họ trước khi đăng nhập vào trang web của bạn.
  - Sẵn sàng dịch
  - Chặn tên người dùng để đăng ký.
  - Chặn tên miền email để đăng ký.
  - Mẫu email có thể tùy chỉnh để xác minh email thông báo.
  - Tự động đăng nhập sau khi xác minh.
  - Tin nhắn tùy chỉnh cho các hoạt động khác nhau.
  - Biểu mẫu đăng nhập mặc định của Google reCAPTCHA, biểu mẫu đăng ký mặc định, biểu mẫu đặt lại mật khẩu mặc định, biểu mẫu nhận xét mặc định, biểu mẫu đăng nhập WooC Commerce, biểu mẫu đăng ký WooC Commerce, biểu mẫu mất mật khẩu WooC Commerce.
  - Tương thích với WooC Commerce, Tắt tự động đăng nhập sau khi đăng ký trên WooC Commerce.
  - Hỗ trợ plugin Thành viên trả phí Pro
  - Gửi lại biểu mẫu khóa xác minh qua shortcode

# Hàm xử lý bị lỗi

- Hàm “user_verification_send_otp()” tạo ra một mã otp với đoạn code sau:
![image](https://github.com/Manh130902/wordpress/assets/93723285/9d6ad7f5-2e04-4354-9d03-5a3bffdea5e3)

- Và gửi cho người dùng mã otp qua email với code sau:
![image](https://github.com/Manh130902/wordpress/assets/93723285/0644cd3b-0d41-4b00-84f8-7eaad7e65cb7)

- Nhưng mã otp cũng được trả về trong phản hồi ajax:
![image](https://github.com/Manh130902/wordpress/assets/93723285/4064289a-e426-4b35-a967-ed66b157e05e)

- Như vậy ta chỉ cần biết được user thì ta có thể đăng nhập vào tài khoản thậm chí là cả tài khoản admin

# Khai thác

- Trước tiên ta sẽ tìm tài khoản trong trang web bằng công cụ Wpscan
![image](https://github.com/Manh130902/wordpress/assets/93723285/21b8d3b9-d358-4cc7-ad8e-7e7e697cbfc6)

- Ta có thẻ thấy nó đã tìm thấy 2 tài khoản trong đó tài khoản test có thể là administrator
- Sau đó ta truy cập vào trang đăng nhập, nhập tên đăng nhập và nhấn gửi otp
![image](https://github.com/Manh130902/wordpress/assets/93723285/79269260-1ab7-4019-8b7d-e91aacfaf21e)

- Ta kiểm tra respone ajax thấy có kèm theo cả password. Ta lấy mật khẩu và đăng nhập.
![image](https://github.com/Manh130902/wordpress/assets/93723285/251f21d5-5bde-43d0-bf4a-88b38404b87c)
![image](https://github.com/Manh130902/wordpress/assets/93723285/a4366176-1c99-4e77-b7a2-5b24edb73627)

- Ta đã đăng nhập được vào trang quản trị

# Sửa Lỗi

- Phiên bản vá lỗi : 1.0.94
![image](https://github.com/Manh130902/wordpress/assets/93723285/0f0700b7-9330-4952-8738-7bad1c8a59b7)
![image](https://github.com/Manh130902/wordpress/assets/93723285/55843e44-a9e9-4697-b7ee-9cc01e7a8c6a)
