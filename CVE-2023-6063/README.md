# CVE-2023-6063

- Plugin : WP Fastest Cache
- Phiên bản lỗi : <=1.2.1
- Lỗi : Unauthenticated SQL Injection
- CVSS Score: 8.6 (HIGH)

## Mô tả

- WP Fastest Cache là một plugin bộ nhớ đệm được sử dụng để tăng tốc độ tải trang, cải thiện trải nghiệm của khách truy cập và tăng thứ hạng của trang web trên công cụ tìm kiếm Google. Hiện tại đã có hơn 1 triệu lượt tải plugin và hơn 600000 trang web đang sử dụng plugin này.
- Lỗ hổng chèn lệnh SQL xảy ra khi phần mềm chấp nhận đầu vào thao tác trực tiếp các truy vấn SQL, dẫn đến việc chạy mã SQL tùy ý để lấy thông tin cá nhân hoặc thực thi lệnh.

## Hàm xử lý bị lỗi

- Lỗ hổng này ảnh hưởng đến chức năng ‘is_user_admin’ của class 'WpFastestCacheCreateCache' trong plugin WP Fastest Cache, nhằm kiểm tra xem người dùng có phải là quản trị viên hay không bằng cách trích xuất giá trị '$username' từ cookie.
![image](https://github.com/Manh130902/wordpress/assets/93723285/d24c0c6e-175c-4a5c-9723-410a82cf5159)

**Giải thích code**

- Sử dụng đối tượng toàn cục $wpdb để tương tác với cơ sở dữ liệu WordPress.
- Duyệt qua mảng $\_COOKIE để tìm một khóa cookie chứa "wordpress_logged_in".
- Trích xuất tên người dùng từ giá trị cookie bằng cách sử dụng biểu thức chính quy.
- Nếu tìm thấy tên người dùng, thực hiện một truy vấn SQL sử dụng $wpdb->get_var để kiểm tra xem người dùng có cấp độ người dùng là “10” (thường tương ứng với vai trò quản trị viên trong WordPress) hay không.
- Nếu người dùng là quản trị viên, hàm trả về kết quả của truy vấn SQL, đó là ID người dùng.
- Nếu không tìm thấy quản trị viên, hàm trả về giá trị false.

## Khai Thác

- Để khai thác thì yêu cầu Cache System phải được enable
![image](https://github.com/Manh130902/wordpress/assets/93723285/940269bc-5fdf-4064-8549-c2ded720a4f0)

#### Sử dụng công cụ Sqlmap để thực hiện tấn công

**B1**: Xác định lỗi là time-based blind sqli
![image](https://github.com/Manh130902/wordpress/assets/93723285/f71f397c-c8d8-4c3d-94fc-0ba3327a7cf8)
![image](https://github.com/Manh130902/wordpress/assets/93723285/3a52f601-2770-4f54-a805-5a7495f53143)

**B2**: Dump các cơ sở dữ liệu
![image](https://github.com/Manh130902/wordpress/assets/93723285/5ab520e0-2f89-4e79-807e-aed6b488ff4e)
![image](https://github.com/Manh130902/wordpress/assets/93723285/442b6190-7b41-4c5c-8ad0-9cda116843e7)

**B3**: Dump bảng trong bảng wordpress
![image](https://github.com/Manh130902/wordpress/assets/93723285/28ad9a33-6322-473a-b5db-85899ebd6bfa)
![image](https://github.com/Manh130902/wordpress/assets/93723285/174aff39-6188-4802-a94d-e8d595cef4a5)
![image](https://github.com/Manh130902/wordpress/assets/93723285/141c77ee-4391-42a3-b799-0a771fde2900)

**B4**: Dump cột có trong bảng wp_users
![image](https://github.com/Manh130902/wordpress/assets/93723285/44ee0677-690a-43bc-8ada-d7df84c90acc)
![image](https://github.com/Manh130902/wordpress/assets/93723285/d6404ed9-f321-43bb-80b6-2d44ae3d4573)

**B5**: Dump giá trị của các cột trong bảng wp_users
![image](https://github.com/Manh130902/wordpress/assets/93723285/5a6c6223-4dd4-4aac-aac3-9eef50711d54)
![image](https://github.com/Manh130902/wordpress/assets/93723285/fa2e9d89-d64f-4378-a679-6333ce3b3d94)

## Sửa Lỗi
![image](https://github.com/Manh130902/wordpress/assets/93723285/da315716-d513-4a39-8be2-0b874d5693af)
