
CVE-2019-15092
- Plugin lỗi: Import Export WordPress Users
- Phiên bản lỗi: 1.3.0
- Lỗi : Authenticated CSV Injection

a) Mô tả
- Plugin Xuất nhập khẩu người dùng WordPress được đánh giá cao nhất từ trước đến nay! Plugin này cho phép bạn dễ dàng nhập và xuất người dùng WordPress và khách hàng WooC Commerce. Nó cho phép bạn di chuyển đến một trang web mới mà không làm mất người dùng hoặc khách hàng, theo đúng nghĩa đen.
- Bạn có thể nhập hoặc xuất dữ liệu người dùng/khách hàng bằng tệp CSV. Điều này giúp di chuyển hoặc cập nhật dữ liệu người dùng trên trang web của bạn.

b) Hàm xử lý bị lỗi 
- Hàm do_export() của lớp WF_CustomerImpExpCsv_Exporter không kiểm tra xem ký tự đầu tiên của các trường có khớp với (=, +, -, @)
![image](https://github.com/Manh130902/wordpress/assets/93723285/4035d5b1-d353-40df-8480-32ff7977ad4c)
 
- Đoạn code này là một phần của một chương trình PHP và thực hiện các công việc sau đây:
1.	Thiết lập một số biến cần thiết để xác định phạm vi xuất dữ liệu CSV và các tùy chọn xuất khác, bao gồm giới hạn số lượng dòng xuất, vị trí bắt đầu xuất, cột dữ liệu cần xuất, vai trò người dùng, và ký tự phân cách.
2.	Tắt bất kỳ thông báo lỗi nào của WordPress và thiết lập thời gian tối đa cho việc thực thi không giới hạn và giới hạn bộ nhớ.
3.	Thiết lập tiêu đề HTTP để xác định loại dữ liệu là CSV và yêu cầu trình duyệt tải dữ liệu dưới dạng tệp đính kèm CSV.
4.	Mở tệp đầu ra(output) bằng cách sử dụng fopen và thiết lập tệp này để viết dữ liệu CSV.
5.	Sử dụng hàm get_users để truy vấn danh sách người dùng dựa trên các tham số đã được đặt trước. Điều này bao gồm giới hạn số lượng người dùng và vị trí bắt đầu.
6.	Xây dựng hàng đầu cho tệp CSV bằng cách duyệt qua các cột đã được định nghĩa và thêm các tên cột vào hàng này. Các cột này sẽ là hàng đầu trong tệp CSV.
7.	Sử dụng vòng lặp foreach để duyệt qua danh sách người dùng và tạo hàng dữ liệu CSV cho mỗi người dùng bằng cách sử dụng hàm WF_CustomerImpExpCsv_Exporter::get_customers_csv_row. Sau đó, dữ liệu hàng này được ghi vào tệp đầu ra.
8.	Cuối cùng, đóng tệp đầu ra, kết thúc quá trình xuất dữ liệu và thoát khỏi mã PHP.

c) Khai thác
- Ta vào phần chỉnh sửa tên người dùng
![image](https://github.com/Manh130902/wordpress/assets/93723285/67a5095b-7771-4ec9-b779-93795c3736dd)
 
- Chỉnh sửa thành các payload : “=1+1” và “=10+20+cmd|' /C calc'!A0” vào các ô đầu vào và lưu chỉnh sửa
- Sau đó vào “Users Import Export” nhấn “Export Users”
![image](https://github.com/Manh130902/wordpress/assets/93723285/07342aa0-3934-49d1-acde-c71fef8a2063)
 
- Ta thấy kiểm tra thấy 1 file CSV đã được xuất ra
  
  ![image](https://github.com/Manh130902/wordpress/assets/93723285/0f883c6f-fbbd-4e6d-9982-8473610ee82a)
 
- Ta mở file lên thì câu lệnh trong payload đã được thực thi
  +  “=1+1” kết quả 2
  + “=10+20+cmd|' /C calc'!A0” kết quả máy tính đã được bật lên
![image](https://github.com/Manh130902/wordpress/assets/93723285/8256a5b9-f65f-4149-baa9-f15397fd739e)

 
